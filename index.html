<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†°å³¶ 13 æ—¥è‡ªé§•éš¨èº«åŠ©ç†</title>
    <style>
        :root {
            --primary-color: #0077BE; /* Ice Blue */
            --accent-color: #E63946; /* Lava Red */
            --bg-color: #F0F4F8;
            --card-bg: #FFFFFF;
            --text-main: #2D3748;
            --text-sub: #718096;
            --nav-height: 65px;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-color); color: var(--text-main); padding-bottom: calc(var(--nav-height) + 20px); }

        /* Helpers */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .font-bold { font-weight: 700; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .p-4 { padding: 1rem; }

        /* Header & Dashboard */
        header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 20px 15px; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative; z-index: 10; }
        .weather-widget { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border-radius: 12px; padding: 10px; margin-top: 10px; display: flex; align-items: center; justify-content: space-between; }
        .weather-icon { font-size: 2.5rem; }
        .temp-main { font-size: 1.8rem; font-weight: bold; }
        
        /* Blizzard Alert */
        #blizzard-alert { background-color: #c0392b; color: white; padding: 10px; text-align: center; display: none; animation: flash 2s infinite; font-weight: bold; font-size: 0.9rem; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: calc(var(--nav-height) + var(--safe-area-bottom)); background: white; display: flex; justify-content: space-around; align-items: flex-start; padding-top: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-sub); text-decoration: none; width: 20%; font-size: 0.7rem; transition: transform 0.1s; }
        .nav-item.active { color: var(--primary-color); font-weight: bold; }
        .nav-item:active { transform: scale(0.9); }
        .nav-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* Pages */
        .page { display: none; animation: fadeIn 0.3s ease; padding: 10px; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Itinerary Cards */
        .day-scroller { overflow-x: auto; white-space: nowrap; padding: 10px 0; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }
        .day-chip { display: inline-block; background: white; padding: 8px 16px; border-radius: 20px; margin-right: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; transition: all 0.2s; }
        .day-chip.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        .timeline-card { background: var(--card-bg); border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; position: relative; }
        .card-img { width: 100%; height: 160px; object-fit: cover; background-color: #ddd; }
        .card-body { padding: 15px; }
        .card-tag { display: inline-block; background: #EDF2F7; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; color: #4A5568; margin-right: 5px; }
        .card-tag.food { background: #FEFCBF; color: #744210; }
        .card-tag.hotel { background: #E6FFFA; color: #234E52; }
        .card-tag.urgent { border: 2px solid var(--accent-color); color: var(--accent-color); font-weight: bold; }

        .btn-action { display: block; width: 100%; text-align: center; background: var(--primary-color); color: white; padding: 10px; border-radius: 8px; text-decoration: none; margin-top: 10px; font-weight: 500; }
        .btn-action.map { background: #EBF8FF; color: #2B6CB0; }
        
        /* Accordion (Language) */
        .accordion-item { background: white; border-radius: 8px; margin-bottom: 10px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .accordion-header { padding: 15px; font-weight: bold; background: #f8fafc; cursor: pointer; display: flex; justify-content: space-between; }
        .accordion-content { display: none; padding: 15px; border-top: 1px solid #eee; }
        .accordion-content.show { display: block; }
        .phrase-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        
        /* Fullscreen Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; padding: 20px; text-align: center; }
        .big-text { font-size: 3rem; font-weight: bold; line-height: 1.2; }
        .sub-text { font-size: 1.2rem; color: #aaa; margin-top: 20px; }
        .close-modal { position: absolute; top: 30px; right: 30px; font-size: 2rem; color: white; cursor: pointer; background: rgba(255,255,255,0.2); width: 40px; height: 40px; border-radius: 50%; line-height: 40px; }

        /* Tools / Expense */
        .tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .tool-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); cursor: pointer; }
        .expense-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
        .expense-list { list-style: none; padding: 0; margin-top: 15px; }
        .expense-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; }

        /* Emergency Button */
        .emergency-btn { background: #E53E3E; color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; position: fixed; bottom: calc(var(--nav-height) + 30px); right: 20px; box-shadow: 0 4px 10px rgba(229, 62, 62, 0.4); z-index: 900; font-weight: bold; font-size: 0.8rem; text-decoration: none; }
    </style>
</head>
<body>

<div id="blizzard-alert">
    âš ï¸ æš´é¢¨é›ªè­¦å ±ï¼šæª¢æ¸¬åˆ°å¼·é¢¨/é™é›ªï¼Œè«‹ç«‹å³æŸ¥è©¢ Road.is ç¢ºèªè·¯æ³ï¼
</div>

<header>
    <div class="flex justify-between items-center">
        <div>
            <h1 style="margin:0; font-size: 1.2rem;">ğŸ‡®ğŸ‡¸ å†°å³¶è‡ªé§•åŠ©ç†</h1>
            <div class="text-xs" style="opacity: 0.8;" id="current-date">è¼‰å…¥ä¸­...</div>
        </div>
        <a href="https://umferdin.is/en" target="_blank" style="background:rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; color: white; text-decoration: none; font-size: 0.8rem;">
            ğŸ›£ï¸ è·¯æ³ Road.is
        </a>
    </div>

    <div class="weather-widget">
        <div class="flex items-center">
            <div id="weather-icon" class="weather-icon">â˜ï¸</div>
            <div style="margin-left: 10px;">
                <div id="weather-temp" class="temp-main">--Â°C</div>
                <div id="weather-desc" class="text-xs">å®šä½ä¸­...</div>
            </div>
        </div>
        <div style="text-align: right;">
            <div id="wind-speed" class="font-bold text-sm">é¢¨é€Ÿ: -- m/s</div>
            <div class="text-xs" style="color: #FFD700;">â˜€ï¸ æ—¥å‡º 07:30</div>
        </div>
    </div>
</header>

<a href="tel:112" class="emergency-btn">112<br>SOS</a>

<main id="main-container">

    <div id="page-itinerary" class="page active">
        <div class="day-scroller" id="day-scroller">
            </div>

        <div id="timeline-container">
            </div>
    </div>

    <div id="page-speak" class="page">
        <h2 class="mb-2">æ‰‹æŒ‡å†°å³¶èª</h2>
        <p class="text-xs text-sub mb-2">é»æ“Šå¥å­å¯æ”¾å¤§é¡¯ç¤ºçµ¦å°æ–¹çœ‹</p>
        
        <div id="language-list">
            </div>
    </div>

    <div id="page-tools" class="page">
        <h2 class="mb-2">å¯¦ç”¨å·¥å…·</h2>
        <div class="tool-grid">
            <div class="tool-card" onclick="window.open('https://en.vedur.is/weather/forecasts/aurora/', '_blank')">
                <div style="font-size: 2rem;">ğŸŒŒ</div>
                <div class="font-bold">æ¥µå…‰é æ¸¬</div>
            </div>
            <div class="tool-card" onclick="window.open('https://www.isavia.is/en/keflavik-airport', '_blank')">
                <div style="font-size: 2rem;">âœˆï¸</div>
                <div class="font-bold">æ©Ÿå ´èˆªç­</div>
            </div>
            <div class="tool-card" onclick="window.open('https://parka.is/', '_blank')">
                <div style="font-size: 2rem;">ğŸ…¿ï¸</div>
                <div class="font-bold">Parka åœè»Š</div>
            </div>
             <div class="tool-card" onclick="window.open('https://www.google.com/maps/search/bonus+supermarket+iceland', '_blank')">
                <div style="font-size: 2rem;">ğŸ·</div>
                <div class="font-bold">æ‰¾å°è±¬è¶…å¸‚</div>
            </div>
        </div>

        <h3 class="mt-2">ğŸ’° æ—…éŠè¨˜å¸³æœ¬</h3>
        <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div class="flex">
                <input type="text" id="expense-desc" placeholder="é …ç›® (å¦‚: åŠ æ²¹)" class="expense-input" style="flex:2; margin-right: 5px;">
                <input type="number" id="expense-amount" placeholder="ISK é‡‘é¡" class="expense-input" style="flex:1;">
            </div>
            <button onclick="addExpense()" style="width:100%; background: #48BB78; color: white; padding: 10px; border:none; border-radius: 8px;">æ–°å¢æ”¯å‡º</button>
            
            <div class="flex justify-between items-center mt-2">
                <strong>ç¸½è¨ˆ: <span id="total-expense">0</span> ISK</strong>
                <button onclick="clearExpenses()" style="color: red; background: none; border: none; font-size: 0.8rem;">æ¸…ç©º</button>
            </div>
            <ul id="expense-list" class="expense-list"></ul>
        </div>
    </div>

    <div id="page-pack" class="page">
        <h2 class="mb-2">è¡Œå‰æª¢æŸ¥ & å‚™å¿˜</h2>
        <div style="background: white; padding: 15px; border-radius: 12px;">
            <div id="checklist-container">
                </div>
        </div>
    </div>

</main>

<nav class="bottom-nav">
    <a href="#" class="nav-item active" onclick="switchPage('itinerary', this)">
        <span class="nav-icon">ğŸ“…</span>
        <span>è¡Œç¨‹</span>
    </a>
    <a href="#" class="nav-item" onclick="switchPage('speak', this)">
        <span class="nav-icon">ğŸ—£ï¸</span>
        <span>æºé€š</span>
    </a>
    <a href="#" class="nav-item" onclick="switchPage('tools', this)">
        <span class="nav-icon">ğŸ§°</span>
        <span>å·¥å…·</span>
    </a>
    <a href="#" class="nav-item" onclick="switchPage('pack', this)">
        <span class="nav-icon">ğŸ’</span>
        <span>æ¸…å–®</span>
    </a>
</nav>

<div id="focus-modal" class="modal-overlay hidden">
    <div class="close-modal" onclick="closeFocusModal()">Ã—</div>
    <div class="big-text" id="focus-icelandic">Takk</div>
    <div class="sub-text" id="focus-english">Thank you</div>
</div>

<script>
    // --- Data: Itinerary ---
    const itineraryData = [
        {
            day: 1, date: "9/27 (å…­)", title: "å°ç£ â†’ å†°å³¶",
            items: [
                { type: 'flight', title: "æ­æ©Ÿæ—¥", desc: "å‰å¾€ KEF æ©Ÿå ´ï¼Œå¤œå®¿æ©Ÿä¸Š", imgKeyword: "airplane window night" }
            ]
        },
        {
            day: 2, date: "9/28 (æ—¥)", title: "æŠµé” & é›·å…‹é›…ç¶­å…‹",
            items: [
                { type: 'car', title: "å–è»Š: LOTUS Car Rental", desc: "å¯†ç¢¼: +354 7874444ã€‚æª¢æŸ¥è¼ªèƒèˆ‡è»Šæ³ã€‚", loc: "Lotus Car Rental Iceland", imgKeyword: "Lotus car rental iceland" },
                { type: 'hotel', title: "SkÃ³lavÃ¶rÃ°ustÃ­gur Apartments", desc: "åœ°å€ï¼šSkÃ³lavÃ¶rÃ°ustÃ­gur 21Aã€‚æ¨“ä¸‹æœ‰æ³°å¼é¤å»³ã€‚", loc: "SkÃ³lavÃ¶rÃ°ustÃ­gur 21A, 101 ReykjavÃ­k", imgKeyword: "Reykjavik street" },
                { type: 'food', title: "æ™šé¤: Old Iceland", desc: "å¿…é»: Icelandic Lamb Soupã€‚é ç®— 1500-2000 TWDã€‚", loc: "Old Iceland Restaurant", imgKeyword: "Lamb soup" },
                { type: 'sight', title: "HallgrÃ­mskirkja æ•™å ‚", desc: "æ‹æ”å¤œæ™¯ã€å½©è™¹è¡—æ•£æ­¥ã€‚", loc: "HallgrÃ­mskirkja", imgKeyword: "HallgrÃ­mskirkja" }
            ]
        },
        {
            day: 3, date: "9/29 (ä¸€)", title: "é›·å…‹é›…ç¶­å…‹ â†’ æ–¯å¥ˆå±±",
            items: [
                { type: 'food', title: "æ—©é¤: Bakari Sandholt", desc: "07:30 é–‹é–€ã€‚æ¨è–¦: è‚‰æ¡‚æ²ã€å¯é Œã€‚", loc: "Sandholt Bakery", imgKeyword: "Bakery croissant" },
                { type: 'sight', title: "Ytri Tunga æµ·è±¹æ²™ç˜", desc: "æ–¯å¥ˆå±±åŠå³¶ï¼Œè§€å¯Ÿæµ·è±¹ã€‚", loc: "Ytri Tunga Beach", imgKeyword: "seal beach iceland" },
                { type: 'sight', title: "Kirkjufell æ•™æœƒå±±", desc: "å†°å³¶åœ°æ¨™ï¼Œæ¬ŠåŠ›éŠæˆ²å ´æ™¯ã€‚", loc: "Kirkjufell", imgKeyword: "Kirkjufell" },
                { type: 'food', title: "æ™šé¤: Harbour CafÃ©", desc: "æ¨è–¦: é­šæ¹¯ã€Plokkfiskur (ç‡‰é­š)ã€‚", loc: "Harbour Cafe GrundarfjÃ¶rÃ°ur", imgKeyword: "Icelandic fish soup" },
                { type: 'hotel', title: "StÃ¶Ã° Guesthouse", desc: "åœ°å€: 13 SÃ³lvellir, GrundarfjÃ¶rÃ°ur", loc: "StÃ¶Ã° Guesthouse and apartments", imgKeyword: "GrundarfjÃ¶rÃ°ur" }
            ]
        },
        {
            day: 4, date: "9/30 (äºŒ)", title: "æ–¯å¥ˆå±± â†’ è¥¿éƒ¨",
            items: [
                { type: 'sight', title: "å¤ªé™½èˆªæµ·è€… & éŸ³æ¨‚å»³", desc: "é›·å…‹é›…ç¶­å…‹è£œæ¼è¡Œç¨‹ (è‹¥ä¹‹å‰æœªå»)ã€‚", loc: "Sun Voyager", imgKeyword: "Sun Voyager" },
                { type: 'food', title: "åˆé¤: BÃ¦jarins Beztu Pylsur", desc: "å…¨æ­æ´²æœ€å¥½åƒçš„ç†±ç‹—ã€‚", loc: "BÃ¦jarins Beztu Pylsur", imgKeyword: "iceland hot dog" },
                { type: 'food', title: "æ™šé¤ A: Messinn", desc: "åŒ—æ¥µç´…é»é®­ (Arctic Char) & æµ·é®®éºµã€‚", loc: "Messinn ReykjavÃ­k", imgKeyword: "Arctic Char dish" },
                { type: 'hotel', title: "Hraunsnef Country Hotel", desc: "è¥¿éƒ¨ä½å®¿ï¼Œå«æ—©é¤å¦è³¼ã€‚", loc: "Hraunsnef Country Hotel", imgKeyword: "Iceland countryside hotel" }
            ]
        },
        {
            day: 5, date: "10/1 (ä¸‰)", title: "è¥¿éƒ¨ â†’ åŒ—éƒ¨",
            items: [
                { type: 'sight', title: "ç†”å²©ç€‘å¸ƒ Hraunfossar", desc: "å‘ˆç¾å¯¶è—è‰²çš„ç‰¹æ®Šç€‘å¸ƒã€‚", loc: "Hraunfossar", imgKeyword: "Hraunfossar" },
                { type: 'sight', title: "BlÃ¶nduÃ³skirkja é¯¨é­šæ•™å ‚", desc: "è£œçµ¦ä¼‘æ¯ç«™ã€‚", loc: "BlÃ¶nduÃ³skirkja", imgKeyword: "BlÃ¶nduÃ³skirkja" },
                { type: 'hotel', title: "SiglÃ³ HÃ³tel", desc: "å«æ—©é¤ï¼Œä½æ–¼ SiglufjÃ¶rÃ°urã€‚", loc: "SiglÃ³ HÃ³tel", imgKeyword: "Siglo Hotel Iceland" }
            ]
        },
        {
            day: 6, date: "10/2 (å››)", title: "åŒ—éƒ¨ç¶“å…¸è·¯ç·š",
            items: [
                { type: 'sight', title: "Akureyri é˜¿å…‹é›·é‡Œ", desc: "åŒ—éƒ¨ä¹‹éƒ½ï¼Œè£œçµ¦/åŠ æ²¹ã€‚", loc: "Akureyri", imgKeyword: "Akureyri church" },
                { type: 'sight', title: "GoÃ°afoss çœ¾ç¥ç€‘å¸ƒ", desc: "æ°£å‹¢ç£…ç¤´çš„ç€‘å¸ƒã€‚", loc: "GoÃ°afoss", imgKeyword: "GoÃ°afoss" },
                { type: 'sight', title: "HÃºsavÃ­k èƒ¡è–©ç¶­å…‹", desc: "æ­æ´²è³é¯¨ä¹‹éƒ½ã€‚", loc: "HÃºsavÃ­k", imgKeyword: "HÃºsavÃ­k harbor" },
                { type: 'sight', title: "ç±³æ¹–æº«æ³‰ MÃ½vatn Nature Baths", desc: "ç‡Ÿæ¥­æ™‚é–“ 12:00-22:00ã€‚", loc: "MÃ½vatn Nature Baths", imgKeyword: "Myvatn Nature Baths" },
                { type: 'hotel', title: "Berjaya Iceland Hotels MÃ½vatn", desc: "ç±³æ¹–ä½å®¿ã€‚", loc: "Berjaya Iceland Hotels MÃ½vatn", imgKeyword: "Myvatn winter" }
            ]
        },
        {
            day: 7, date: "10/3 (äº”)", title: "æ±éƒ¨å³½ç£",
            items: [
                { type: 'sight', title: "GrjÃ³tagjÃ¡ æ´ç©´æº«æ³‰", desc: "æ¬ŠåŠ›éŠæˆ² Jon Snow åå ´é¢ã€‚", loc: "GrjÃ³tagjÃ¡", imgKeyword: "GrjÃ³tagjÃ¡ cave" },
                { type: 'sight', title: "Dettifoss é»›æç€‘å¸ƒ", desc: "æ­æ´²æ°´é‡æœ€å¤§ç€‘å¸ƒã€‚", loc: "Dettifoss", imgKeyword: "Dettifoss" },
                { type: 'sight', title: "StuÃ°lagil Canyon", desc: "ç„æ­¦å²©å³½è°· (éœ€å¾’æ­¥)ã€‚", loc: "StuÃ°lagil Canyon", imgKeyword: "StuÃ°lagil Canyon" },
                { type: 'sight', title: "SeyÃ°isfjÃ¶rÃ°ur", desc: "ç™½æ—¥å¤¢å†’éšªç‹æ»‘æ¿è·¯æ®µã€‚", loc: "SeyÃ°isfjÃ¶rÃ°ur", imgKeyword: "SeyÃ°isfjÃ¶rÃ°ur rainbow road" },
                { type: 'hotel', title: "Bankinn Hotel by Aldan", desc: "å«æ—©é¤ã€‚", loc: "Bankinn Hotel by Aldan", imgKeyword: "SeyÃ°isfjÃ¶rÃ°ur hotel" }
            ]
        },
        {
            day: 8, date: "10/4 (å…­)", title: "å†°å·å¥è¡Œ (Day 1)",
            items: [
                { type: 'sight', title: "Blue Ice Cave Adventure", desc: "09:00 å‡ºç™¼ï¼Œæ™‚é•· 5-6 å°æ™‚ (å·²ä»˜æ¬¾)ã€‚", loc: "JÃ¶kulsÃ¡rlÃ³n", imgKeyword: "Blue Ice Cave Iceland" },
                { type: 'hotel', title: "SkyrhÃºsid Guesthouse", desc: "é€£ä½å…©æ™šä¹‹ç¬¬ä¸€æ™šã€‚", loc: "SkyrhÃºsid Guesthouse", imgKeyword: "SkyrhÃºsid Guesthouse" }
            ]
        },
        {
            day: 9, date: "10/5 (æ—¥)", title: "å†°å·å¥è¡Œ (Day 2)",
            items: [
                { type: 'sight', title: "æ·±åº¦æ¢ç´¢ / ä¼‘æ¯", desc: "äº«å—å†°å·å‘¨é‚Šæˆ–èª¿æ•´è¡Œç¨‹ã€‚", loc: "VatnajÃ¶kull", imgKeyword: "VatnajÃ¶kull glacier" },
                { type: 'hotel', title: "SkyrhÃºsid Guesthouse", desc: "é€£ä½å…©æ™šä¹‹ç¬¬äºŒæ™šã€‚", loc: "SkyrhÃºsid Guesthouse", imgKeyword: "Iceland guesthouse" }
            ]
        },
        {
            day: 10, date: "10/6 (ä¸€)", title: "å†°æ²³æ¹–",
            items: [
                { type: 'sight', title: "JÃ¶kulsÃ¡rlÃ³n å†°æ²³æ¹–", desc: "éŠèˆ¹ (è‹¥æœ‰é è¨‚)ã€‚", loc: "JÃ¶kulsÃ¡rlÃ³n", imgKeyword: "JÃ¶kulsÃ¡rlÃ³n lagoon" },
                { type: 'sight', title: "Diamond Beach é‘½çŸ³æ²™ç˜", desc: "æ‹æ”å¤§å†°å¡Šã€‚", loc: "Diamond Beach Iceland", imgKeyword: "Diamond Beach Iceland" },
                { type: 'food', title: "æ™šé¤: Kjarr Restaurant", desc: "æ¨è–¦: Seafood Pasta / Arctic Charã€‚", loc: "Kjarr Restaurant", imgKeyword: "Seafood pasta" },
                { type: 'hotel', title: "Hunkubakkar Guesthouse", desc: "å«æ—©é¤ã€‚", loc: "Hunkubakkar Guesthouse", imgKeyword: "Hunkubakkar" }
            ]
        },
        {
            day: 11, date: "10/7 (äºŒ)", title: "å—å²¸ç€‘å¸ƒç·š",
            items: [
                { type: 'sight', title: "FjaÃ°rÃ¡rgljÃºfur ç¾½æ¯›å³½è°·", desc: "Justin Bieber MV æ‹æ”åœ°ã€‚", loc: "FjaÃ°rÃ¡rgljÃºfur", imgKeyword: "FjaÃ°rÃ¡rgljÃºfur" },
                { type: 'sight', title: "Vik é»‘æ²™ç˜", desc: "åˆé¤/è£œçµ¦ã€‚å°å¿ƒç˜‹ç‹—æµªï¼", loc: "Reynisfjara Beach", imgKeyword: "Reynisfjara Beach" },
                { type: 'food', title: "Mia's Country Van", desc: "ç‚¸é­šè–¯æ¢ (SkÃ³gafoss æ—)ã€‚", loc: "Mia's Country Van", imgKeyword: "Fish and chips" },
                { type: 'sight', title: "Seljalandsfoss", desc: "æ°´ç°¾æ´ç€‘å¸ƒï¼Œå¯èµ°åˆ°å¾Œæ–¹ã€‚", loc: "Seljalandsfoss", imgKeyword: "Seljalandsfoss" },
                { type: 'hotel', title: "Selfoss BSG åº¦å‡å±‹", desc: "é›»è©±: +354 661 8642", loc: "Selfoss", imgKeyword: "Selfoss Iceland" }
            ]
        },
        {
            day: 12, date: "10/8 (ä¸‰)", title: "é»ƒé‡‘åœˆ",
            items: [
                { type: 'sight', title: "KeriÃ° ç«å£æ¹–", desc: "ç´…è‰²ç«å±±å²©èˆ‡è—æ¹–æ°´ã€‚", loc: "Kerid Crater", imgKeyword: "Kerid Crater" },
                { type: 'sight', title: "Gullfoss é»ƒé‡‘ç€‘å¸ƒ", desc: "é›™æ–·å±¤æ°£å‹¢ç€‘å¸ƒã€‚", loc: "Gullfoss", imgKeyword: "Gullfoss" },
                { type: 'sight', title: "Geysir é–“æ­‡æ³‰", desc: "Strokkur æ¯ 5-10 åˆ†é˜å™´ç™¼ã€‚", loc: "Geysir", imgKeyword: "Geysir eruption" },
                { type: 'sight', title: "Ãingvellir åœ‹å®¶å…¬åœ’", desc: "æ­ç¾æ¿å¡Šäº¤ç•Œè™•ã€‚", loc: "Thingvellir National Park", imgKeyword: "Thingvellir" },
                { type: 'hotel', title: "é›·å…‹é›…ç¶­å…‹å¸‚ä¸­å¿ƒ", desc: "è¿”å›å¸‚å€ã€‚", loc: "Reykjavik", imgKeyword: "Reykjavik night" }
            ]
        },
        {
            day: 13, date: "10/9 (å››)", title: "æº«æ³‰ãƒ»é‚„è»Š",
            items: [
                { type: 'sight', title: "Sky Lagoon", desc: "11:00-22:00ã€‚çµ•ç¾ç„¡é‚Šéš›æº«æ³‰ã€‚", loc: "Sky Lagoon", imgKeyword: "Sky Lagoon Iceland" },
                { type: 'car', title: "é‚„è»Š & æ©Ÿå ´", desc: "20:00 LOTUS é‚„è»Šã€‚æ¥é§è‡³æ©Ÿå ´é£¯åº—ã€‚", loc: "Keflavik Airport", imgKeyword: "Keflavik Airport" },
                { type: 'hotel', title: "Aurora Hotel", desc: "æ©Ÿå ´æ—ä½å®¿ã€‚", loc: "Aurora Hotel at Reykjavik-Keflavik Airport", imgKeyword: "Aurora Hotel Iceland" }
            ]
        }
    ];

    // --- Data: Phrases ---
    const phrases = [
        { category: "åŸºæœ¬ (Basic)", list: [
            { is: "HallÃ³", en: "Hello" },
            { is: "Takk", en: "Thank you" },
            { is: "JÃ¡ / Nei", en: "Yes / No" },
            { is: "HjÃ¡lp!", en: "Help!" }
        ]},
        { category: "é¤å»³ (Dining)", list: [
            { is: "Reikninginn, takk", en: "The bill, please" },
            { is: "Hvar er klÃ³settiÃ°?", en: "Where is the toilet?" },
            { is: "Einn bjÃ³r, takk", en: "One beer, please" },
            { is: "Vatn", en: "Water" }
        ]},
        { category: "ç·Šæ€¥/äº¤é€š (Emergency)", list: [
            { is: "Ã‰g er tÃ½ndur", en: "I am lost" },
            { is: "Hringdu Ã¡ 112", en: "Call 112" },
            { is: "Hvar er bensÃ­nstÃ¶Ã°?", en: "Where is a gas station?" }
        ]}
    ];

    // --- Data: Checklist ---
    const checklistItems = [
        "è­·ç…§ & é§•ç…§ (æ­£æœ¬+ç¿»è­¯æœ¬)", "ä¿¡ç”¨å¡ (éœ€æœ‰ PIN ç¢¼)", "é˜²æ°´å¤–å¥— & è¤²å­", 
        "ç™»å±±é‹ (é˜²æ°´)", "æ³³è¡£ (æº«æ³‰ç”¨)", "æ¯›å¸½ & æ‰‹å¥— & åœå·¾", 
        "è»Šç”¨æ‰‹æ©Ÿæ¶", "æ­è¦è½‰æ¥é ­ (Type C/F)", "è¡Œå‹•é›»æº", "ä¿æº«ç“¶"
    ];

    // --- State ---
    let expenses = JSON.parse(localStorage.getItem('iceland_expenses')) || [];
    let checks = JSON.parse(localStorage.getItem('iceland_checks')) || {};

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
        renderItinerary();
        renderPhrases();
        renderTools();
        renderChecklist();
        initWeather();
        
        // Date display
        const d = new Date();
        document.getElementById('current-date').innerText = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
    });

    // --- Functions: Itinerary ---
    function renderItinerary() {
        const scroller = document.getElementById('day-scroller');
        const container = document.getElementById('timeline-container');
        
        itineraryData.forEach((dayData, index) => {
            // Scroller Chip
            const chip = document.createElement('div');
            chip.className = `day-chip ${index === 0 ? 'active' : ''}`;
            chip.innerText = `Day ${dayData.day}`;
            chip.onclick = () => scrollToDay(index);
            scroller.appendChild(chip);

            // Card
            const card = document.createElement('div');
            card.className = 'timeline-card';
            card.id = `day-card-${index}`;
            
            let itemsHtml = '';
            dayData.items.forEach(item => {
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.loc)}`;
                const imgSrc = `https://image.pollinations.ai/prompt/${encodeURIComponent(item.imgKeyword + " scenery iceland")}`;
                
                // Alert border for key items
                let borderStyle = item.type === 'flight' || item.type === 'car' ? 'border-left: 5px solid var(--accent-color);' : '';

                itemsHtml += `
                    <div style="margin-bottom: 20px; ${borderStyle} padding-left: ${borderStyle ? '10px' : '0'};">
                        <img src="${imgSrc}" class="card-img" style="border-radius:8px; margin-bottom:8px;" loading="lazy" alt="${item.title}">
                        <div class="flex items-center mb-2">
                            <span class="card-tag ${item.type}">${getIcon(item.type)} ${item.type.toUpperCase()}</span>
                            <span class="font-bold text-sm">${item.title}</span>
                        </div>
                        <div class="text-sm text-sub">${item.desc}</div>
                        <a href="${mapLink}" target="_blank" class="btn-action map">ğŸ“ å°èˆªå»é€™è£¡</a>
                    </div>
                    <hr style="border:0; border-top:1px dashed #eee; margin: 15px 0;">
                `;
            });

            card.innerHTML = `
                <div style="background: var(--primary-color); color: white; padding: 10px 15px;">
                    <h3 style="margin:0;">Day ${dayData.day}ï½œ${dayData.date}</h3>
                    <div class="text-sm" style="opacity:0.9;">${dayData.title}</div>
                </div>
                <div class="card-body">
                    ${itemsHtml}
                </div>
            `;
            container.appendChild(card);
        });
    }

    function getIcon(type) {
        const map = { flight: 'âœˆï¸', car: 'ğŸš—', hotel: 'ğŸ¨', food: 'ğŸ½ï¸', sight: 'ğŸ“·' };
        return map[type] || 'ğŸ“';
    }

    function scrollToDay(index) {
        // Update chips
        document.querySelectorAll('.day-chip').forEach((c, i) => {
            if (i === index) c.classList.add('active');
            else c.classList.remove('active');
        });
        
        // Scroll to card
        const card = document.getElementById(`day-card-${index}`);
        card.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Adjust scroll offset for header
        window.scrollBy(0, -180); 
    }

    // --- Functions: Weather & Blizzard Monitor ---
    async function initWeather() {
        // Default to Reykjavik if GPS fails
        const defaultLat = 64.1355;
        const defaultLon = -21.8954;

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => fetchWeatherData(pos.coords.latitude, pos.coords.longitude),
                () => fetchWeatherData(defaultLat, defaultLon)
            );
        } else {
            fetchWeatherData(defaultLat, defaultLon);
        }
    }

    async function fetchWeatherData(lat, lon) {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,wind_speed_10m&wind_speed_unit=ms`);
            const data = await res.json();
            const current = data.current;
            
            // Update UI
            document.getElementById('weather-temp').innerText = `${Math.round(current.temperature_2m)}Â°C`;
            document.getElementById('wind-speed').innerText = `é¢¨é€Ÿ: ${current.wind_speed_10m} m/s`;
            document.getElementById('weather-icon').innerText = getWeatherEmoji(current.weather_code);
            document.getElementById('weather-desc').innerText = "ç•¶å‰ä½ç½®æ°£è±¡";

            // Blizzard Logic: Wind > 15m/s or heavy snow codes (71, 73, 75, 85, 86)
            if (current.wind_speed_10m > 15 || [71, 73, 75, 85, 86].includes(current.weather_code)) {
                document.getElementById('blizzard-alert').style.display = 'block';
            }
        } catch (e) {
            console.error("Weather fetch failed", e);
            document.getElementById('weather-desc').innerText = "é›¢ç·šæ¨¡å¼";
        }
    }

    function getWeatherEmoji(code) {
        if (code <= 3) return 'â˜ï¸';
        if (code <= 48) return 'ğŸŒ«ï¸'; // Fog
        if (code <= 67) return 'ğŸŒ§ï¸'; // Rain
        if (code <= 77) return 'ğŸŒ¨ï¸'; // Snow
        if (code <= 82) return 'ğŸŒ§ï¸'; // Rain showers
        if (code <= 86) return 'ğŸŒ¨ï¸'; // Snow showers
        return 'â›ˆï¸';
    }

    // --- Functions: Phrases ---
    function renderPhrases() {
        const list = document.getElementById('language-list');
        phrases.forEach(group => {
            const item = document.createElement('div');
            item.className = 'accordion-item';
            
            let rows = '';
            group.list.forEach(p => {
                rows += `
                    <div class="phrase-row" onclick="showFocus('${p.is.replace(/'/g, "\\'")}', '${p.en.replace(/'/g, "\\'")}')">
                        <div>
                            <div class="font-bold">${p.is}</div>
                            <div class="text-xs text-sub">${p.en}</div>
                        </div>
                        <span style="color:var(--primary-color);">ğŸ”</span>
                    </div>
                `;
            });

            item.innerHTML = `
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    ${group.category}
                    <span>â–¼</span>
                </div>
                <div class="accordion-content">
                    ${rows}
                </div>
            `;
            list.appendChild(item);
        });
    }

    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        content.classList.toggle('show');
    }

    function showFocus(is, en) {
        document.getElementById('focus-icelandic').innerText = is;
        document.getElementById('focus-english').innerText = en;
        document.getElementById('focus-modal').classList.remove('hidden');
    }

    function closeFocusModal() {
        document.getElementById('focus-modal').classList.add('hidden');
    }

    // --- Functions: Tools (Expense) ---
    function renderTools() {
        const list = document.getElementById('expense-list');
        list.innerHTML = '';
        let total = 0;
        
        expenses.forEach(ex => {
            total += parseFloat(ex.amount);
            const li = document.createElement('li');
            li.className = 'expense-item';
            li.innerHTML = `<span>${ex.desc}</span> <span>${ex.amount}</span>`;
            list.appendChild(li);
        });
        
        document.getElementById('total-expense').innerText = total.toLocaleString();
    }

    function addExpense() {
        const desc = document.getElementById('expense-desc').value;
        const amount = document.getElementById('expense-amount').value;
        
        if (desc && amount) {
            expenses.push({ desc, amount });
            localStorage.setItem('iceland_expenses', JSON.stringify(expenses));
            renderTools();
            document.getElementById('expense-desc').value = '';
            document.getElementById('expense-amount').value = '';
        }
    }

    function clearExpenses() {
        if(confirm('ç¢ºå®šæ¸…ç©ºè¨˜å¸³ç´€éŒ„ï¼Ÿ')) {
            expenses = [];
            localStorage.setItem('iceland_expenses', JSON.stringify(expenses));
            renderTools();
        }
    }

    // --- Functions: Checklist ---
    function renderChecklist() {
        const container = document.getElementById('checklist-container');
        checklistItems.forEach(item => {
            const div = document.createElement('div');
            div.style.padding = '8px 0';
            div.style.borderBottom = '1px solid #eee';
            
            const isChecked = checks[item] ? 'checked' : '';
            
            div.innerHTML = `
                <label class="flex items-center">
                    <input type="checkbox" ${isChecked} onchange="toggleCheck('${item}')" style="transform: scale(1.3); margin-right: 10px;">
                    ${item}
                </label>
            `;
            container.appendChild(div);
        });
    }

    function toggleCheck(item) {
        checks[item] = !checks[item];
        localStorage.setItem('iceland_checks', JSON.stringify(checks));
    }

    // --- Navigation Logic ---
    function switchPage(pageId, navEl) {
        // Nav active state
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navEl.classList.add('active');
        
        // Page visibility
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(`page-${pageId}`).classList.add('active');
        
        // Scroll to top
        window.scrollTo(0, 0);
    }

</script>
</body>
</html>
