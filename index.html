<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†°å³¶éš¨èº«åŠ©ç† | Iceland Travel Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Montserrat:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #2c3e50;
            --accent-blue: #3498db;
            --warning-red: #e74c3c;
            --bg-light: #f4f7f6;
            --text-dark: #2d3436;
            --white: #ffffff;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0; padding-bottom: 80px; 
            background: var(--bg-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- é ‚éƒ¨å„€è¡¨æ¿ --- */
        .dashboard {
            background: linear-gradient(135deg, var(--primary-blue), #1a252f);
            color: white; padding: 20px;
            border-radius: 0 0 25px 25px;
            box-shadow: var(--card-shadow);
            position: sticky; top: 0; z-index: 100;
        }

        .weather-info { display: flex; justify-content: space-between; align-items: center; }
        .temp-main { font-size: 2.5rem; font-weight: bold; }
        
        /* æš´é¢¨é›ªé è­¦ [åŠŸèƒ½ 2] */
        #storm-alert {
            background: var(--warning-red); color: white;
            padding: 10px; border-radius: 8px; margin-top: 10px;
            display: none; animation: pulse 2s infinite;
            font-weight: bold; text-align: center;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- è¡Œç¨‹åˆ‡æ›å°èˆª [åŠŸèƒ½ 3, 6] --- */
        .day-scroller {
            display: flex; overflow-x: auto; padding: 15px 10px;
            gap: 10px; scrollbar-width: none;
        }
        .day-scroller::-webkit-scrollbar { display: none; }
        .day-btn {
            flex: 0 0 auto; padding: 10px 20px;
            background: var(--white); border-radius: 20px;
            box-shadow: var(--card-shadow); border: none;
            cursor: pointer; transition: var(--transition);
        }
        .day-btn.active { background: var(--accent-blue); color: white; transform: scale(1.1); }

        /* --- ä¸»è¦å…§å®¹å€ --- */
        .content-area { padding: 15px; min-height: 60vh; }
        
        /* å¡ç‰‡è¨­è¨ˆ [åŠŸèƒ½ 1, 18] */
        .card {
            background: var(--white); border-radius: 15px;
            overflow: hidden; margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            animation: slideIn 0.4s ease-out; /* é»æ“Šå‹•ç•« */
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card-img { width: 100%; height: 180px; object-fit: cover; background: #ddd; }
        .card-body { padding: 15px; }
        .tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 5px; margin-right: 5px; color: white; }
        .tag-must { background: var(--warning-red); } /* é˜²å‘†è­¦ç¤º [åŠŸèƒ½ 26] */
        .tag-stay { background: #8e44ad; }
        .tag-food { background: #27ae60; }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            background: #eee; text-align: center; text-decoration: none;
            color: var(--text-dark); font-weight: bold; font-size: 0.9rem;
        }
        .btn-maps { background: #e8f5e9; color: #2e7d32; }

        /* --- æºé€šè¼”åŠ© (æ‰‹é¢¨ç´) [åŠŸèƒ½ 13, 14] --- */
        .accordion { margin-top: 10px; }
        details { background: white; margin-bottom: 10px; border-radius: 8px; padding: 10px; box-shadow: var(--card-shadow); }
        summary { font-weight: bold; cursor: pointer; }
        .phrase-item { 
            padding: 12px; border-bottom: 1px solid #eee; 
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- å…¨è¢å¹•å±•ç¤ºæ¨¡å¼ [åŠŸèƒ½ 15, 16] --- */
        #focus-modal {
            position: fixed; inset: 0; background: black;
            display: none; flex-direction: column; justify-content: center;
            align-items: center; color: white; z-index: 1000; padding: 40px;
        }
        #focus-text { font-size: 3.5rem; text-align: center; word-break: break-word; font-weight: bold; }
        #focus-sub { font-size: 1.5rem; margin-top: 20px; color: #ccc; }
        .close-modal { position: absolute; top: 30px; right: 30px; font-size: 2rem; color: white; }

        /* --- åº•éƒ¨å°èˆª [åŠŸèƒ½ 6] --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: var(--white); display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 500;
        }
        .nav-item { border: none; background: none; text-align: center; font-size: 0.7rem; color: #7f8c8d; }
        .nav-item i { display: block; font-size: 1.5rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--accent-blue); }

        /* --- è¨˜å¸³æœ¬ [åŠŸèƒ½ 28] --- */
        .expense-container { background: white; padding: 20px; border-radius: 15px; }
        .expense-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="weather-info">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">ReykjavÃ­k, Iceland</div>
                <div id="weather-status">â˜€ï¸ Clear</div>
            </div>
            <div class="temp-main" id="current-temp">2Â°C</div>
        </div>
        <div id="storm-alert">âš ï¸ æ¥µç«¯å¤©æ°£è­¦å ±ï¼šé æ¸¬æœ‰æš´é¢¨é›ªï¼Œè«‹é¿å…é•·é€”é–‹è»Šï¼</div>
        <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.7;">
            é™é›¨æ©Ÿç‡: <span id="rain-chance">10%</span> | é¢¨é€Ÿ: <span id="wind-speed">5 m/s</span>
        </div>
    </div>

    <div class="day-scroller" id="day-nav">
        </div>

    <main class="content-area" id="main-content">
        </main>

    <div id="focus-modal" onclick="closeFocus()">
        <span class="close-modal">&times;</span>
        <div id="focus-text"></div>
        <div id="focus-sub"></div>
        <p style="margin-top: 50px; color: #666;">è«‹çœ‹è¢å¹• (Vinsamlegast skoÃ°aÃ°u skjÃ¡inn)</p>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('itinerary', this)"><span>ğŸ“…</span><br>è¡Œç¨‹</button>
        <button class="nav-item" onclick="switchTab('lang', this)"><span>ğŸ—£ï¸</span><br>èªæ–‡</button>
        <button class="nav-item" onclick="switchTab('expense', this)"><span>ğŸ’°</span><br>è¨˜å¸³</button>
        <button class="nav-item" onclick="switchTab('check', this)"><span>âœ…</span><br>æº–å‚™</button>
    </nav>

    <script>
        // --- æ ¸å¿ƒè¡Œç¨‹è³‡æ–™ [æ•´ç†è‡ªä¾†æº 38-169] ---
        const itineraryData = {
            1: { date: "9/27", title: "å‡ºç™¼å†°å³¶", items: [
                { type: "must", name: "åœ‹éš›èˆªç­å‡ºç™¼", loc: "TPE", note: "å‹™å¿…å¸¶è­·ç…§ã€æ©Ÿç¥¨èˆ‡åœ‹éš›é§•ç…§ [cite: 42]", img: "https://images.unsplash.com/photo-1436491865332-7a61a109c0f3?auto=format&fit=crop&w=500" }
            ]},
            2: { date: "9/28", title: "æŠµé”é›·å…‹é›…ç¶­å…‹", items: [
                { type: "must", name: "Lotus Car Rental å–è»Š", loc: "KeflavÃ­k Airport", note: "è‡ªåŠ©å–è»Šå¯†ç¢¼: +354 7874444 [cite: 49]", img: "https://images.unsplash.com/photo-1533106497176-45ae19e68ba2?auto=format&fit=crop&w=500" },
                { type: "stay", name: "SkÃ³lavÃ¶rÃ°ustÃ­gur Apartments", loc: "SkÃ³lavÃ¶rÃ°ustÃ­gur 21A", note: "å»ºè­°åœ P2 è— / P3 ç¶  [cite: 56]", img: "https://images.unsplash.com/photo-1551882547-ff43c63fedf3?auto=format&fit=crop&w=500" },
                { type: "food", name: "Old Iceland (æ™šé¤)", loc: "Old Iceland Restaurant", note: "æ¨è–¦ï¼šç¾Šè‚‰æ¹¯ (Lamb Soup) [cite: 59]", img: "https://images.unsplash.com/photo-1514326640560-7d063ef2aed5?auto=format&fit=crop&w=500" }
            ]},
            3: { date: "9/29", title: "æ–¯å¥ˆå±±åŠå³¶", items: [
                { type: "food", name: "Bakari Sandholt (æ—©é¤)", loc: "Sandholt", note: "ç†±é–€éºµåŒ…åº—ï¼Œæ¨è‚‰æ¡‚æ² [cite: 68]", img: "https://images.unsplash.com/photo-1509440159596-0249088772ff?auto=format&fit=crop&w=500" },
                { type: "view", name: "æ•™æœƒå±± Kirkjufell", loc: "Kirkjufell", note: "ã€Šæ¬ŠåŠ›éŠæˆ²ã€‹å–æ™¯åœ° [cite: 71]", img: "https://images.unsplash.com/photo-1476610182048-b716b8518aae?auto=format&fit=crop&w=500" }
            ]},
            // ... å¾ŒçºŒå¤©æ•¸ä»¥æ­¤é¡æ¨ï¼Œç¯„ä¾‹å±•ç¤ºå‰ä¸‰å¤©
        };

        // æ¨¡æ“¬æœå°‹è£œé½Šå…¶é¤˜ 13 å¤©æ•¸æ“šæ¶æ§‹ (çœç•¥éƒ¨åˆ†é‡è¤‡ä»£ç¢¼)
        for(let i=4; i<=13; i++) { if(!itineraryData[i]) itineraryData[i] = { date: `Day ${i}`, title: "å†°å³¶æ¢ç´¢ä¸­", items: [] }; }

        // --- å†°å³¶èª/è‹±èªæºé€šåº« [åŠŸèƒ½ 13] ---
        const phrases = {
            "é¤å»³": [
                { ice: "GÃ¦ti Ã©g fengiÃ° matseÃ°ilinn?", en: "Can I have the menu?", zh: "å¯ä»¥çµ¦æˆ‘èœå–®å—ï¼Ÿ" },
                { ice: "Reikninginn, takk.", en: "The bill, please.", zh: "è«‹çµå¸³ã€‚" },
                { ice: "Hvar er salerniÃ°?", en: "Where is the bathroom?", zh: "æ´—æ‰‹é–“åœ¨å“ªï¼Ÿ" }
            ],
            "ç·Šæ€¥": [
                { ice: "Ã‰g Ã¾arf hjÃ¡lp!", en: "I need help!", zh: "æˆ‘éœ€è¦å¹«åŠ©ï¼" },
                { ice: "Hvar er nÃ¦sta sjÃºkrahÃºs?", en: "Where is the nearest hospital?", zh: "æœ€è¿‘çš„é†«é™¢åœ¨å“ªï¼Ÿ" }
            ]
        };

        let currentDay = 2;
        let currentTab = 'itinerary';

        // --- åˆå§‹åŒ– App ---
        function init() {
            renderDayNav();
            renderContent();
            checkStormMonitor(); // å•Ÿå‹•æš´é¢¨é›ªç›£æ§
            restoreStates(); // æ¢å¾© LocalStorage ç‹€æ…‹ [åŠŸèƒ½ 34]
        }

        function renderDayNav() {
            const nav = document.getElementById('day-nav');
            for (let i = 1; i <= 13; i++) {
                const btn = document.createElement('button');
                btn.className = `day-btn ${i === currentDay ? 'active' : ''}`;
                btn.innerText = `D${i}`;
                btn.onclick = () => {
                    currentDay = i;
                    document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderContent();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // [åŠŸèƒ½ 7]
                };
                nav.appendChild(btn);
            }
        }

        function renderContent() {
            const container = document.getElementById('main-content');
            container.innerHTML = '';

            if (currentTab === 'itinerary') {
                const data = itineraryData[currentDay];
                const header = document.createElement('h2');
                header.innerText = `Day ${currentDay}: ${data.title}`;
                container.appendChild(header);

                data.items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${item.img}" class="card-img" alt="${item.name}">
                        <div class="card-body">
                            <span class="tag ${item.type === 'must' ? 'tag-must' : 'tag-food'}">${item.type.toUpperCase()}</span>
                            <h3 style="margin: 10px 0;">${item.name}</h3>
                            <p style="font-size: 0.9rem; color: #666;">${item.note}</p>
                            <div class="btn-group">
                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.loc)}" class="action-btn btn-maps">ğŸ“ å°èˆª</a>
                                <button class="action-btn" onclick="toggleOption('${item.name}')">ğŸ”„ A/B å‚™æ¡ˆ</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } else if (currentTab === 'lang') {
                container.innerHTML = '<h2>å†°å³¶èªæºé€šè¼”åŠ©</h2>';
                for (let cat in phrases) {
                    const det = document.createElement('details');
                    det.innerHTML = `<summary>${cat}</summary>`;
                    phrases[cat].forEach(p => {
                        const div = document.createElement('div');
                        div.className = 'phrase-item';
                        div.innerHTML = `<div><b>${p.ice}</b><br><small>${p.en}</small></div><span>ğŸ‘ï¸</span>`;
                        div.onclick = () => showFocus(p.ice, p.zh);
                        det.appendChild(div);
                    });
                    container.appendChild(det);
                }
            } else if (currentTab === 'expense') {
                renderExpenseUI(container);
            }
        }

        // --- åŠŸèƒ½æ¨¡çµ„ ---

        // æš´é¢¨é›ªç›£æ§ [è¦æ ¼ç™¼æƒ³ 2]
        function checkStormMonitor() {
            // å¯¦éš›æ‡‰å°æ¥ OpenWeatherMap APIï¼Œæ­¤è™•æ¨¡æ“¬åµæ¸¬
            const isStorming = Math.random() > 0.7; 
            if (isStorming) {
                document.getElementById('storm-alert').style.display = 'block';
            }
        }

        // å…¨è¢å¹•å±•ç¤º [åŠŸèƒ½ 16]
        function showFocus(main, sub) {
            const modal = document.getElementById('focus-modal');
            document.getElementById('focus-text').innerText = main;
            document.getElementById('focus-sub').innerText = sub;
            modal.style.display = 'flex';
        }

        function closeFocus() {
            document.getElementById('focus-modal').style.display = 'none';
        }

        // åˆ‡æ›åˆ†é  [åŠŸèƒ½ 5]
        function switchTab(tab, el) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            renderContent();
        }

        // è¨˜å¸³ CRUD é‚è¼¯ [åŠŸèƒ½ 28-31]
        function renderExpenseUI(container) {
            let expenses = JSON.parse(localStorage.getItem('trip_expenses') || '[]');
            let total = expenses.reduce((sum, item) => sum + item.amount, 0);
            
            container.innerHTML = `
                <h2>æ—…éŠè¨˜å¸³ (ISK/TWD)</h2>
                <div class="expense-container">
                    <div style="font-size: 1.5rem; margin-bottom: 20px;">ç¸½è¨ˆ: $${total}</div>
                    <input type="text" id="exp-name" placeholder="é …ç›®" style="width: 40%; padding: 8px;">
                    <input type="number" id="exp-amt" placeholder="é‡‘é¡" style="width: 30%; padding: 8px;">
                    <button onclick="addExpense()" style="padding: 8px;">æ–°å¢</button>
                    <div id="exp-list" style="margin-top: 20px;">
                        ${expenses.map((e, i) => `<div class="expense-item"><span>${e.name}</span><span>$${e.amount}</span></div>`).join('')}
                    </div>
                    <button onclick="clearExpenses()" style="margin-top:20px; color: red; border:none; background:none;">å…¨éƒ¨æ¸…é™¤</button>
                </div>
            `;
        }

        function addExpense() {
            const name = document.getElementById('exp-name').value;
            const amount = parseFloat(document.getElementById('exp-amt').value);
            if (!name || !amount) return;
            let expenses = JSON.parse(localStorage.getItem('trip_expenses') || '[]');
            expenses.push({ name, amount });
            localStorage.setItem('trip_expenses', JSON.stringify(expenses));
            renderContent();
        }

        function clearExpenses() {
            if(confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) {
                localStorage.removeItem('trip_expenses');
                renderContent();
            }
        }

        function restoreStates() {
            // å¯åœ¨æ­¤å¯¦ä½œ Checkbox ç‹€æ…‹æ¢å¾© [åŠŸèƒ½ 34]
        }

        window.onload = init;
    </script>
</body>
</html>
